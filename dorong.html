<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì¹´ì¹´ì˜¤ ì£¼ì†Œ ê²€ìƒ‰ ë° ì¢Œí‘œ ë³€í™˜</title>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=076e534c41e81d0280f67bca54ac8d8c&libraries=services"></script>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      }
      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }
      .search-box {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
      }
      input[type="text"] {
        flex: 1;
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s;
      }
      input[type="text"]:focus {
        outline: none;
        border-color: #667eea;
      }
      button {
        padding: 12px 24px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
        transition: transform 0.2s;
      }
      button:hover {
        transform: translateY(-2px);
      }
      button:active {
        transform: translateY(0);
      }
      .result-box {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin-top: 20px;
        display: none;
      }
      .result-box.show {
        display: block;
        animation: fadeIn 0.5s;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .info-item {
        margin: 10px 0;
        padding: 10px;
        background: white;
        border-radius: 5px;
        border-left: 4px solid #667eea;
      }
      .label {
        font-weight: bold;
        color: #667eea;
        display: inline-block;
        width: 120px;
      }
      .value {
        color: #333;
      }
      .notice {
        background: #fff3cd;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        border-left: 4px solid #ffc107;
      }
      #map {
        width: 100%;
        height: 300px;
        border-radius: 10px;
        margin-top: 20px;
        display: none;
      }
      #map.show {
        display: block;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ—ºï¸ ì¹´ì¹´ì˜¤ ì£¼ì†Œ ê²€ìƒ‰ ë° ì¢Œí‘œ ë³€í™˜</h1>

      <div class="notice">
        <strong>âœ… API í‚¤ ì„¤ì • ì™„ë£Œ:</strong> ì¹´ì¹´ì˜¤ Maps API í‚¤ê°€ ì •ìƒì ìœ¼ë¡œ
        ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ ì£¼ì†Œ ê²€ìƒ‰ê³¼ ì¢Œí‘œ ë³€í™˜ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </div>

      <div class="search-box">
        <input
          type="text"
          id="address"
          placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ê²€ìƒ‰ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”"
          readonly
        />
        <button onclick="execDaumPostcode()">ì£¼ì†Œ ê²€ìƒ‰</button>
      </div>

      <div id="result" class="result-box">
        <h3>ğŸ“ ì£¼ì†Œ ì •ë³´</h3>
        <div class="info-item">
          <span class="label">ìš°í¸ë²ˆí˜¸:</span>
          <span class="value" id="zonecode">-</span>
        </div>
        <div class="info-item">
          <span class="label">ë„ë¡œëª… ì£¼ì†Œ:</span>
          <span class="value" id="roadAddress">-</span>
        </div>
        <div class="info-item">
          <span class="label">ì§€ë²ˆ ì£¼ì†Œ:</span>
          <span class="value" id="jibunAddress">-</span>
        </div>

        <h3 style="margin-top: 20px">ğŸŒ ì¢Œí‘œ ì •ë³´</h3>
        <div class="info-item">
          <span class="label">ìœ„ë„ (Latitude):</span>
          <span class="value" id="latitude">-</span>
        </div>
        <div class="info-item">
          <span class="label">ê²½ë„ (Longitude):</span>
          <span class="value" id="longitude">-</span>
        </div>
      </div>

      <div id="map"></div>
    </div>

    <script>
      // API ë¡œë”© ì™„ë£Œ í™•ì¸
      function waitForKakaoAPI(callback) {
        if (typeof kakao !== "undefined" && kakao.maps && kakao.maps.services) {
          callback();
        } else {
          setTimeout(() => waitForKakaoAPI(callback), 100);
        }
      }

      // ì¹´ì¹´ì˜¤ ìš°í¸ë²ˆí˜¸ ì„œë¹„ìŠ¤ ì‹¤í–‰
      function execDaumPostcode() {
        new daum.Postcode({
          oncomplete: function (data) {
            // ì„ íƒí•œ ì£¼ì†Œ ì •ë³´ í‘œì‹œ
            document.getElementById("address").value = data.address;
            document.getElementById("zonecode").textContent = data.zonecode;
            document.getElementById("roadAddress").textContent =
              data.roadAddress || "-";
            document.getElementById("jibunAddress").textContent =
              data.jibunAddress || data.autoJibunAddress || "-";

            // ê²°ê³¼ ë°•ìŠ¤ í‘œì‹œ
            document.getElementById("result").classList.add("show");

            // ì£¼ì†Œë¡œ ì¢Œí‘œ ë³€í™˜ (API ë¡œë”© ëŒ€ê¸°)
            waitForKakaoAPI(() => getCoordinates(data.address));
          },
        }).open();
      }

      // ì£¼ì†Œë¥¼ ì¢Œí‘œë¡œ ë³€í™˜
      function getCoordinates(address) {
        // ë””ë²„ê¹… ì •ë³´ ì¶œë ¥
        console.log("kakao ê°ì²´:", typeof kakao);
        console.log("kakao.maps:", kakao && kakao.maps);
        console.log(
          "kakao.maps.services:",
          kakao && kakao.maps && kakao.maps.services
        );

        // ì¹´ì¹´ì˜¤ Maps APIê°€ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
        if (
          typeof kakao === "undefined" ||
          !kakao.maps ||
          !kakao.maps.services
        ) {
          let errorMsg = "ì¹´ì¹´ì˜¤ Maps API ë¡œë”© ì‹¤íŒ¨\n\n";
          if (typeof kakao === "undefined") {
            errorMsg += "â€¢ kakao ê°ì²´ê°€ ì •ì˜ë˜ì§€ ì•ŠìŒ\n";
            errorMsg += "â€¢ API í‚¤ê°€ ìœ íš¨í•˜ì§€ ì•Šê±°ë‚˜ ë„ë©”ì¸ì´ ë“±ë¡ë˜ì§€ ì•ŠìŒ\n";
            errorMsg += "â€¢ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”\n\n";
            errorMsg += "í•´ê²° ë°©ë²•:\n";
            errorMsg += "1. ì¹´ì¹´ì˜¤ ê°œë°œì ì„¼í„°ì—ì„œ í”Œë«í¼ ì„¤ì • í™•ì¸\n";
            errorMsg +=
              "2. í˜„ì¬ ë„ë©”ì¸(localhost ë˜ëŠ” íŒŒì¼ ê²½ë¡œ)ì´ ë“±ë¡ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸\n";
            errorMsg += "3. API í‚¤ê°€ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸";
          } else if (!kakao.maps) {
            errorMsg += "â€¢ kakao.maps ê°ì²´ê°€ ë¡œë“œë˜ì§€ ì•ŠìŒ";
          } else if (!kakao.maps.services) {
            errorMsg += "â€¢ services ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•ŠìŒ";
          }

          alert(errorMsg);
          document.getElementById("latitude").textContent = "API ë¡œë”© ì‹¤íŒ¨";
          document.getElementById("longitude").textContent = "API ë¡œë”© ì‹¤íŒ¨";
          return;
        }

        const geocoder = new kakao.maps.services.Geocoder();

        geocoder.addressSearch(address, function (result, status) {
          if (status === kakao.maps.services.Status.OK) {
            const coords = new kakao.maps.LatLng(result[0].y, result[0].x);

            // ì¢Œí‘œ í‘œì‹œ
            document.getElementById("latitude").textContent = result[0].y;
            document.getElementById("longitude").textContent = result[0].x;

            // ì§€ë„ í‘œì‹œ
            displayMap(coords);
          } else {
            document.getElementById("latitude").textContent = "ë³€í™˜ ì‹¤íŒ¨";
            document.getElementById("longitude").textContent = "ë³€í™˜ ì‹¤íŒ¨";
          }
        });
      }

      // ì§€ë„ í‘œì‹œ
      function displayMap(coords) {
        const mapContainer = document.getElementById("map");
        mapContainer.classList.add("show");

        const mapOption = {
          center: coords,
          level: 3,
        };

        const map = new kakao.maps.Map(mapContainer, mapOption);

        // ë§ˆì»¤ í‘œì‹œ
        const marker = new kakao.maps.Marker({
          position: coords,
        });
        marker.setMap(map);
      }
    </script>
  </body>
</html>
